<div class="table-responsive" id="plan-table">
  <table class="table table-hover">
    <thead>
      <tr>
        {{#if controllers.job.isShopsTab}}
        <th {{action "sort" "csi"}}><a>CSI</a></th>
        <th {{action "sort" "status"}}><a>Status</a></th>
        {{else}}
          {{#if controllers.job.isASITab}}
          <th {{action "sort" "code"}}><a>ASI</a></th>
          <th {{action "sort" "description"}}><a>Description</a></th>
          <th {{action "sort" "affected"}}><a>Affects</a></th>
          {{else}}
          <th {{action "sort" "plan_num"}}><a>#</a></th>
          {{/if}}
        {{/if}}
        <th {{action "sort" "plan_name"}}><a>Plan Name</a></th>
        <th {{action "sort" "plan_updated_at"}}><a>Updated</a></th>
        <th {{action "sort" "filename"}}><a>Download File</a></th>
        <th class="text-right">Controls</th>
      </tr>
    </thead>
    <tbody>
      {{#each controller}}
      {{#if hasPlan}}
      <tr class="table-row-button" data-link="/api/plans/embedded/{{unbound id}}">
        {{else}} <!-- else does not have plan -->
        <tr>
          {{/if}} <!-- end of hasPlan -->
          {{#if this.belongsToShops}}
          <td><span class="text-nowrap">{{csi_formatter csi}}</span></td>
          <td><span>{{unbound status}}</span></td>
          {{else}}
            {{#if this.belongsToASI}}
            <td><span>{{code}}</span>C</td>
            <td><span>{{description}}</span>D</td>
            <td><span>{{link_id}}</span>A</td>
            {{else}}
            <td><span>{{plan_num}}</span></td>
            {{/if}}
          {{/if}} <!-- belongsToShops -->
          <td class="word"><span title="{{unbound plan_name}}">{{plan_name}}</span></td>
          <td><span>{{date plan_updated_at}}</span></td>
          <td><a href="/api/download/{{unbound id}}" title="{{unbound plan_file_name}}">{{truncate plan_file_name}}</a></td>
          <td>
            <ul class="controls text-right unstyled">
              {{#if hasPlan}}
              {{#if fileIsPDF}}
              <li style="display:none"><a class="pdf-viewer" href="/web/viewer.html?file={{ unbound encode_URL getPlanURI }}" title="Beta PDF Viewer" data-content="This option is in beta testing and renders your PDF without using the browsers default viewer. This option is intended to remove cross-browser differences and can zoom. It may not work for older PDFs!" data-toggle="popover" target="_blank">PDF Viewer</a></li>
              {{/if}}
              <li><a href="/api/plans/embedded/{{unbound id}}" target="_blank">View</a></li>
              {{/if}}
              {{#unless controller.job.isShared}}
              <li><a {{action "openEditPlanModal" this}} data-id="{{unbound id}}">Edit</a></li>
              <li><a {{action "openDeletePlanModal" this}}><span class="glyphicon glyphicon-remove"></span></a></li>
              {{/unless}}
            </ul>
          </td>
        </tr>
        {{else}}
        <tr>
          <td>
            {{#manager}}
            {{#unless job.isShared}}
            <p>You need to add a plan to your job.</p>
            {{else}}
            <p>The owner hasn't added any plans.</p>
            {{/unless}}
            {{else}}
            <p>The owner of this plan has not added any plans.</p>
            {{/manager}}
          </td>

          {{#unless controllers.job.isShopsTab}}
          <td>{{plan_num}}</td>
          {{/unless}}

        </tr>
        {{/each}}
      </tbody>
    </table>
  </div>
  <script>
  $(function () {
    $('[data-toggle="popover"]').popover({trigger:"hover", placement:"top", delay:500})
  })
  </script>
