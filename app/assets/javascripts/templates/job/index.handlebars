<h2>{{name}} {{#if archived}}(Archived){{/if}}</h2>
<div class="row">
  <div class="col-sm-12">
  <p><a {{ action "back" target="controller" }}>Back to your jobs</a></p>
    {{#unless isShared}}
      {{#if archived}}
          {{#manager}}
              <a href="#" {{action "unarchiveJob"}} class="button button-green">Unarchive</a>
          {{/manager}}
      {{else}}
          {{#manager}}
              <a href="#" {{action "archiveJob"}} class="button button-red">Archive</a>
              <a href="#" {{action "openAddPlanModal"}} class="button button-green">+ Add Plan</a>
              <a href="#" {{action "openSubShareLinkModal"}} class="button button-blue">Share Link</a>
          {{/manager}}
      {{/if}}
  {{else}}
      {{#can_share_link}}
          <a href="#" {{action "openSubShareLinkModal"}} class="button button-blue">Share Link</a>
      {{/can_share_link}}
  {{/unless}}
    <input placeholder="Search..." class="form-control form-smaller form-control-padding pull-right" style="max-width:250px" id="search-input"/>
    </div>
</div>


<nav id="jobs-nav" class="jobs-controls">
    {{#if canViewPlansTab}}
        {{#if isPlansTab}}
            <a class="active">Plans</a>
        {{else}}
            <a {{action "changeTab" "Plans"}}>Plans</a>
        {{/if}}
    {{/if}}

    {{#if canViewShopsTab}}
        {{#if isShopsTab}}
            <a class="active">Shops</a>
        {{else}}
            <a {{action "changeTab" "Shops"}}>Shops</a>
        {{/if}}
    {{/if}}

    {{#if canViewConsultantsTab}}
        {{#if isConsultantsTab}}
            <a class="active">Consultants</a>
        {{else}}
            <a {{action "changeTab" "Consultants"}}>Consultants</a>
        {{/if}}
    {{/if}}

    {{#unless isShared}}
        {{#if isCalcTab}}
            <a class="active">Calcs & Misc</a>
        {{else}}
            <a {{action "changeTab" "Calcs & Misc"}}>Calcs & Misc</a>
        {{/if}}
    {{/unless}}
</nav>

<div class="table-responsive" id="plan-table">
  <table class="table table-hover">
  	<thead>
  		<th>#</th>
      {{#if isShopsTab}}
        <th>Description</th>
      {{else}}
        <th>Plan Name</th>
      {{/if}}
  		<th>Updated</th>
  		<th>Download File</th>
  		<th class="text-right">Controls</th>
  	</thead>
  	<tbody>
  	   {{outlet}}
  	</tbody>
  </table>
</div>

<script>
  var readyTableLinks = function(){
    // console.log("Loading table links")
    $("tr").click(function(e){
      // console.log("clicked!");
      if($(this).hasClass("table-row-button")){
        if (e.target.nodeName != "A" && e.target.nodeName != "SPAN" ) { // Make sure normal links still function
          console.log(this.getAttribute("data-link"));
          window.open(this.getAttribute("data-link"), '_blank');
        }
      }
    });
  }

  // When the tree changes, we need to make sure the rows can still be selected
  $("#plan-table").bind("DOMSubtreeModified", function(){
    readyTableLinks();
  });

  $(document).ready(function(){
    readyTableLinks();
  });
</script>
<script>
  function toggleResults(filter){
    jQuery("table tr").not('thead tr').each(function () {
        if (jQuery(this).text().search(new RegExp(filter, "i")) < 0) {
            jQuery(this).hide();
        } else {
            jQuery(this).show()
        }
    });
  }

  $("#search-input").keyup(function () {
      console.log("Searching!")
      var filter = jQuery(this).val();
      toggleResults(filter);
  });
  $('#jobs-nav').bind('DOMSubtreeModified', function(e) {
      console.log("Triggered")
      var filter = $("#search-input").val();
      toggleResults(filter);
  });
</script>
