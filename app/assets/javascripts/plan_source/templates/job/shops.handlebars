<div class="table-responsive" id="plan-table">
  {{#can_review_submittal}}
    {{#if jobController.submittalCount}}
      <p><a href="#" {{action "openSubmittalListModal"}} class="button button-green">{{jobController.submittalCount}} Submittals For Review</a></p>
    {{/if}}
  {{/can_review_submittal}}

  <table class="table table-hover">
    <thead>
      <tr>
        <th {{action "sort" "csi"}}><a>CSI</a></th>
        <th {{action "sort" "plan_name"}}><a>Plan Name</a></th>
        <th {{action "sort" "status"}}><a>Status</a></th>
        <th {{action "sort" "plan_updated_at"}}><a>Updated</a></th>
        <th {{action "sort" "filename"}}><a>Download File</a></th>
        <th class="text-right">Controls</th>
      </tr>
    </thead>
    <tbody>
      {{#each controller}}
        {{#if hasPlan}}
          <tr class="table-row-button" data-link="/api/plans/embedded/{{unbound id}}">
        {{else}}
          <tr>
        {{/if}}

          <td><span class="text-nowrap">{{csi_formatter csi}}</span></td>

          <td class="word"><span title="{{unbound plan_name}}">{{plan_name}}</span></td>

          <td><span>{{unbound status}}</span></td>

          <td><span>{{date plan_updated_at}}</span></td>
          <td><a href="/api/download/{{unbound id}}" title="{{unbound plan_file_name}}">{{truncate plan_file_name}}</a></td>

          <td>
            <ul style="padding-left:0px;" class="controls text-right unstyled">
              {{#if hasPlan}}
                {{#if fileIsPDF}}
                  <li style="display:none"><a class="pdf-viewer" href="/web/viewer.html?file={{ unbound encode_URL getPlanURI }}" title="Beta PDF Viewer" data-content="This option is in beta testing and renders your PDF without using the browsers default viewer. This option is intended to remove cross-browser differences and can zoom. It may not work for older PDFs!" data-toggle="popover" target="_blank">PDF Viewer</a></li>
                {{/if}}

                <li><a href="/api/plans/embedded/{{unbound id}}" target="_blank">View</a></li>
              {{/if}}
              {{#unless jobController.isShared}}
                <li><a {{action "openDeletePlanModal" this}}>Delete</a></li>
                <li><a {{action "openEditPlanModal" this}} data-id="{{unbound id}}">Edit</a></li>
              {{/unless}}
              <li><a {{action "openDetailsPlanModal" this}} data-id="{{unbound id}}">Details</a></li>
            </ul>
          </td>
        </tr>
      {{else}}
        <tr>
          <td>
            {{#manager}}
              {{#unless job.isShared}}
                <p>You need to add a plan to your job.</p>
              {{else}}
                <p>The owner hasn't added any plans.</p>
              {{/unless}}
            {{else}}
              <p>The owner of this plan has not added any plans.</p>
            {{/manager}}
          </td>
        </tr>
      {{/each}}
    </tbody>
  </table>
</div>

<script>
  $(function () {
    $('[data-toggle="popover"]').popover({trigger:"hover", placement:"top", delay:500})
  })
</script>

